import pandas as pd
from pydriller import Repository
import re

# Initialize empty list to store commit data
project_data =[]
developer_data = []
commits_data = []
class_data = []
method_data = []

# Specify the path to your repository
repo_path = 'https://github.com/khurramirshad/FoodDeliveryProject'
class_regex = re.compile(r'class\s+(\w+)\s*')

# Traverse through commits
for commit in Repository(repo_path).traverse_commits():
    # Projectid,ProjectName,Date
    project_data.append({
        'ProjectId':commit.project_name,
        'ProjectName':commit.project_name,
        'Date':commit.author_date
    })
    #DeveloperId,Name,Projectid,
    developer_data.append({
        'DeveloperId':commit.author.name,
        'Name':commit.author.name,
        'ProjectId':commit.project_name

    })

    # CommitId,ProjectID,Date,DeveloperId,Branch
    commits_data.append({
        'CommitId': commit.hash,
        'ProjectID': commit.project_name,
        'date': commit.author_date,
        'DeveloperId': commit.author.name,
        'Branch': commit.branches 
    })


    for modified_file in commit.modified_files:
        if modified_file.filename.endswith('.java') and modified_file.source_code:
            # Find all class id,Name,CommitId
            found_classes = class_regex.findall(modified_file.source_code)
            if found_classes:
                class_data.append({
                    'ClassId': found_classes[0],
                    'Name': found_classes[0],
                    'CommitId': commit.hash               
                })


# Create a DataFrame from the list of commits
df_peoject = pd.DataFrame(project_data)
df_developer=pd.DataFrame(developer_data)
df_commits = pd.DataFrame(commits_data)
df_classes = pd.DataFrame(class_data)
# Save the DataFrame to a CSV file
df_peoject.to_csv('D:\MS\Dissertation\logs\project.csv', index=False)
df_developer.to_csv('D:\MS\Dissertation\logs\developer.csv', index=False)
df_commits.to_csv('D:\MS\Dissertation\logs\commits.csv', index=False)
df_classes.to_csv('D:\MS\Dissertation\logs\class.csv', index=False)